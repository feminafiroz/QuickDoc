import{m as X,b as Y,u as ee,r as a,z as M,o as se,j as e,U as c,C as te}from"./index-BZQwGW2S.js";import{N as oe}from"./navbar-CJwMmKqO.js";import{a as d}from"./axiosService-D_CQMRTJ.js";import{s as p}from"./toaster-DBZDDvmy.js";import{c as ae,d as ne}from"./index-4jKjJyz1.js";import{F as re}from"./index-D4ixeR3g.js";import{a as ie}from"./axios-B6xwUs71.js";import"./logo-NL4NpGi6.js";import"./setnget-jfIHgayU.js";import"./index-VWaDGczM.js";import"./iconBase-9lu4LLBA.js";const ve=()=>{var A,E;const u=X(s=>s.UserSlice),{id:l}=Y(),j=ee(),[t,N]=a.useState(null),[n,T]=a.useState(null),[$,h]=a.useState(!1),[F,v]=a.useState(!1),[z,b]=a.useState(!1),[g,y]=a.useState(null),[C,H]=a.useState(""),[S,k]=a.useState(""),[D,P]=a.useState(1),[x,R]=a.useState(!1),f=u.id,U=u.name,B=M.ZegoUIKitPrebuilt.generateKitTokenForTest(1874253558,"b20915d03efd29962f6e3dc9c4e02ac0",null,f,U);M.ZegoUIKitPrebuilt.create(B).addPlugins({ZIM:se.ZIM}),a.useEffect(()=>{const s=async()=>{try{const m=(await d.get(`${c}/bookingdetails/${l}`)).data.data.bookingDetails;N(m);const i=await d.get(`${c}/doctor/${m.doctorId}`);T(i.data.doctor),await r()}catch(o){console.error("Error fetching booking details:",o)}},r=async()=>{try{const o=await d.get(`${c}/reviewexists`,{params:{appointment:l}});R(o.data.reviewExists)}catch(o){console.error("Error checking review existence:",o)}};s()},[l,f]);const Z=async()=>{try{await d.put(`${c}/bookingdetails/${l}`,{appoinmentStatus:"Cancelled",cancelReason:C}),N(s=>({...s,appoinmentStatus:"Cancelled"})),p("Appoinment Cancelled","success"),h(!1)}catch(s){console.error("Error cancelling appointment:",s)}},K=(s,r)=>{let[o,m]=r.split(" "),[i,L]=o.split(":").map(Number);m==="PM"&&i<12&&(i+=12),m==="AM"&&i===12&&(i=0);const w=new Date(s);w.setHours(i,L,0,0);const Q=new Date(w.getTime()-60*60*1e3),I=new Date;return I>=Q&&I<=w},O=()=>{j(`/user/appoinment/${t.doctorId}`)},W=()=>{const s=new Date(t.date);if(K(s,t.timeSlot))return e.jsx("p",{className:"text-green-700 text-xl font-bold",children:"Please stay on this site. The doctor will connect with you on time."});if(t.appoinmentStatus==="Booked")return e.jsx("button",{onClick:()=>h(!0),className:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded mt-5",children:"Cancel Appointment"});if(t.appoinmentStatus==="Cancelled")return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-red-700 text-xl text-bold",children:"Appointment Cancelled"}),e.jsx("button",{onClick:O,className:"bg-green-800 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:"Reschedule Appointment"})]});if(t.appoinmentStatus==="Consulted"||t.appoinmentStatus==="unConsulted")return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-green-700 text-xl text-bold",children:"Consultation Completed"}),e.jsx("button",{onClick:()=>b(!0),className:`bg-green-700 hover:bg-green-600 text-white font-bold py-2 px-4 rounded mt-5 ${x?"opacity-50 cursor-not-allowed":""}`,disabled:x,children:x?"Review Added":"Add Review"})]})},_=async s=>{const r={appoinmentId:s},o=await d.post(`${c}/fetchPrescription`,r);o.data&&o.data.response?(y(o.data.response),v(!0)):p("No prescription added by the doctor","error")};function V(){v(!1),y(null)}const q=()=>{b(!1)},G=()=>{ie.post(te+"/conversations",{senderId:u.id,recieverId:n._id}).then(({})=>{j("/user/chat")}).catch(()=>{console.log("error in sending chat")})},J=async()=>{try{(await d.post(`${c}/createreviews`,{review:{rating:D,reviewText:S,user:f,doctor:t.doctorId,appoinment:l}})).status===200?(p("Review submitted successfully","success"),b(!1),k(""),P(1),R(!0)):alert("Failed to submit review")}catch(s){console.error("Error submitting review:",s),p("Error submitting review","error")}};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Booking Details"}),t&&n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-green-200",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:n.profileImage,alt:n.doctorName,className:"w-40 h-40 rounded mr-4"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Dr. ",n.doctorName]}),e.jsx("p",{children:(A=n==null?void 0:n.department)==null?void 0:A.departmnetName}),e.jsx("p",{className:"text-green-600 font-semibold",children:"Verified"}),e.jsx("div",{className:"flex",children:e.jsxs("button",{onClick:()=>G(),className:"bg-blue-800 flex hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-3",children:[e.jsx(re,{className:"mr-2 mt-1"}),"Chat"]})})]})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md border ",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-1 mt-4",children:"Prescription"}),e.jsx("p",{className:"mb-3 text-blue-900",children:"Click the button to see the prescription"}),e.jsxs("button",{onClick:()=>_(l),className:"bg-green-800 flex hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:[e.jsx(ae,{className:"mr-2 mt-1"}),"Check Prescription"]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-blue-200",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:" Appointment Details "}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Date: ",new Date(t.date).toLocaleDateString()]}),e.jsxs("p",{className:"font-medium",children:["Time Slot: ",t.timeSlot]}),e.jsxs("p",{className:"font-medium",children:["Patient Name: ",t.patientName]}),e.jsxs("p",{className:"font-medium",children:["Patient Problem: ",t.patientProblem]}),W()]})]})]}),$&&e.jsx("div",{className:"fixed top-0 left-0 flex justify-center items-center w-full h-full bg-gray-900 bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-xl transform transition-all max-w-lg w-full",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Reason for Cancellation"}),e.jsx("div",{className:"mt-2",children:e.jsx("textarea",{value:C,onChange:s=>H(s.target.value),className:"block w-full p-2 sm:text-sm border-gray-300 rounded-md",rows:4,placeholder:"Enter reason for cancellation"})})]}),e.jsxs("div",{className:"bg-gray-100 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{onClick:Z,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-500 text-base font-medium text-white hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm",children:"Confirm"}),e.jsx("button",{onClick:()=>h(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancel"})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-lg w-full",children:g?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 border-b pb-2",children:"Prescription Details"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-bold",children:"Doctor:"})," ",n.doctorName]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-bold",children:"Prescription Date:"})," ",new Date(g.prescriptionDate).toDateString()]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Medicines:"}),e.jsx("ul",{className:"list-disc list-inside pl-4 space-y-2",children:(E=g.medicines)==null?void 0:E.map((s,r)=>e.jsxs("li",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",e.jsx("span",{className:"text-red-700",children:s.name})," -",e.jsx("span",{className:"font-semibold",children:" Dosage:"})," ",e.jsx("span",{className:"text-red-700",children:s.dosage})," -",e.jsx("span",{className:"font-semibold",children:" Instructions:"})," ",e.jsx("span",{className:"text-red-700",children:s.instructions})]},r))})]}),e.jsx("div",{className:"flex justify-end space-x-4",children:e.jsx("button",{onClick:V,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition ease-in-out duration-300",children:"Close"})})]}):e.jsx("p",{className:"text-gray-700",children:"No Prescription added ..."})})}),z&&e.jsx("div",{className:"fixed top-0 left-0 flex justify-center items-center w-full h-full bg-gray-900 bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Review Appointment"}),e.jsx("button",{onClick:q,className:"text-gray-500 hover:text-gray-600",children:e.jsx(ne,{})})]}),e.jsx("textarea",{className:"w-full h-32 p-2 border border-gray-300 rounded mb-4",placeholder:"Write your review",value:S,onChange:s=>k(s.target.value)}),e.jsx("label",{className:"block mb-2 font-bold",children:"Rating:"}),e.jsxs("select",{value:D,onChange:s=>P(parseInt(s.target.value)),className:"w-full p-2 border border-gray-300 rounded mb-4",children:[e.jsx("option",{value:1,children:"1 - Very Poor"}),e.jsx("option",{value:2,children:"2 - Poor"}),e.jsx("option",{value:3,children:"3 - Average"}),e.jsx("option",{value:4,children:"4 - Good"}),e.jsx("option",{value:5,children:"5 - Excellent"})]}),e.jsx("button",{onClick:J,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:x?"Review Added":"Submit Review"})]})})]})]})};export{ve as default};
