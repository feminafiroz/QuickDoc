import{b as _,m as G,u as W,r as o,z as f,o as q,j as e,D as m,U as Q,C as X}from"./index-00cI4IgE.js";import{N as Y}from"./Navbar-BnSOKXii.js";import{F as ee}from"./Footer-CXM-4f4a.js";import{a as x}from"./axiosService-vpQesCrw.js";import{G as j}from"./iconBase-CrgXBa7-.js";import{s as d}from"./toaster-KRpCf2CE.js";import{F as se}from"./index-BwFTFjof.js";import{a as te}from"./axios-B6xwUs71.js";import"./logo-NL4NpGi6.js";import"./setnget-jfIHgayU.js";import"./index-D2ECkgNr.js";import"./index-D-igGuhj.js";import"./index-VWaDGczM.js";function ae(l){return j({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M15 4H5V20H19V8H15V4ZM3 2.9918C3 2.44405 3.44749 2 3.9985 2H16L20.9997 7L21 20.9925C21 21.5489 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5447 3 21.0082V2.9918ZM11 11V8H13V11H16V13H13V16H11V13H8V11H11Z"},child:[]}]})(l)}function ne(l){return j({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0 0 42 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"},child:[]}]})(l)}function re(l){return j({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M912 302.3L784 376V224c0-35.3-28.7-64-64-64H128c-35.3 0-64 28.7-64 64v576c0 35.3 28.7 64 64 64h592c35.3 0 64-28.7 64-64V648l128 73.7c21.3 12.3 48-3.1 48-27.6V330c0-24.6-26.7-40-48-27.7zM712 792H136V232h576v560zm176-167l-104-59.8V458.9L888 399v226zM208 360h112c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H208c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"},child:[]}]})(l)}const le=()=>{var P;const{id:l}=_(),p=G(t=>t.DoctorSlice),D=W(),[s,N]=o.useState(null),[M,V]=o.useState(!0),[I,h]=o.useState(!1),[y,k]=o.useState(new Date().toISOString().split("T")[0]),[H,z]=o.useState(""),[A,g]=o.useState(!1),[i,u]=o.useState([{name:"",dosage:"",instructions:""}]),[c,v]=o.useState(null),[w,C]=o.useState(!1),[E,F]=o.useState(!1),T=p.id,L=p.name,$=f.ZegoUIKitPrebuilt.generateKitTokenForTest(1874253558,"b20915d03efd29962f6e3dc9c4e02ac0",null,T,L),b=f.ZegoUIKitPrebuilt.create($);b.addPlugins({ZIM:q.ZIM});function O(){if(!b){console.error("ZegoUIKitPrebuilt instance is not initialized.");return}const t={userID:s.userId,userName:s.patientName};b.sendCallInvitation({callees:[t],callType:f.ZegoUIKitPrebuilt.InvitationTypeVideoCall,timeout:60}).then(a=>{console.warn(a),F(!0)}).catch(a=>{console.warn(a)})}o.useEffect(()=>{const t=async()=>{try{const r=(await x.get(`${Q}/bookingdetails/${l}`)).data.data.bookingDetails;N(r),((r==null?void 0:r.appoinmentStatus)==="Consulted"||(r==null?void 0:r.appoinmentStatus)==="unConsulted")&&C(!0)}catch(n){console.error("Error fetching patient details:",n)}finally{V(!1)}},a=async()=>{try{const n=await x.get(`${m}/prescription/${l}`);n.data.response&&n.data.response.length>0&&v(n.data.response[0])}catch(n){console.error("Error fetching prescription details:",n)}};t(),a()},[l]);const Z=()=>{h(!0)},U=()=>{g(!0)},R=()=>{h(!1)},K=async()=>{const t={appointmentId:l,prescriptionDate:y,medicines:i};await x.post(`${m}/addPrescription`,t)&&d("Prescription added successfully","success"),h(!1)},S=async t=>{if(!E){d("Please join the video call with the patient first.","error");return}try{(await x.put(`${m}/bookingdetails/${l}`,{appoinmentStatus:t})).status===200?(N(n=>({...n,appoinmentStatus:t})),C(!0),d(`Appointment consultation ${t==="Consulted"?"Successful":"unConsulted"}`,"success")):d("Failed to update consultation status","error")}catch(a){console.error("Error updating appointment consultation status:",a),d("Error updating appointment consultation status","error")}};if(M)return e.jsx("div",{className:"flex justify-center items-center h-screen bg-gray-100",children:e.jsx("p",{className:"text-xl font-semibold",children:"Loading..."})});const B=()=>{te.post(X+"/conversations",{senderId:s.userId,recieverId:p.id}).then(({data:t})=>{console.log(t,"dataaaaaaaa"),D("/doctor/chat")}).catch(()=>{console.log("error in sending chat")})};return e.jsxs("div",{className:"flex justify-center items-center py-10 bg-gray-100",children:[e.jsxs("div",{className:"w-full max-w-2xl bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-center",children:"Patient Details"}),s?e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Name"}),e.jsx("p",{className:"text-gray-900",children:s.patientName})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Age"}),e.jsx("p",{className:"text-gray-900",children:s.patientAge})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Gender"}),e.jsx("p",{className:"text-gray-900",children:s.patientGender})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Problem"}),e.jsx("p",{className:"text-gray-900",children:s.patientProblem})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Date"}),e.jsx("p",{className:"text-gray-900",children:new Date(s.date).toLocaleDateString()})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Time"}),e.jsx("p",{className:"text-gray-900",children:s.timeSlot})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Payment Status"}),e.jsx("p",{className:"text-gray-900",children:s.paymentStatus})]}),s.appoinmentStatus==="Booked"||(s==null?void 0:s.appoinmentStatus)=="Consulted"||(s==null?void 0:s.appoinmentStatus)=="unConsulted"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Chat with Patient"}),e.jsxs("button",{className:"bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-800 flex items-center mt-3",onClick:B,children:[e.jsx(se,{className:"mr-2"})," Chat"]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Join Video call"}),e.jsxs("button",{className:`bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-700 flex items-center mt-3 ${w?"opacity-50 cursor-not-allowed":""}`,onClick:O,disabled:w,children:[e.jsx(re,{className:"mr-2"})," Join"]})]}),(s==null?void 0:s.appoinmentStatus)=="unConsulted"||(s==null?void 0:s.appoinmentStatus)=="Consulted"?e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Consultation Status"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:s==null?void 0:s.appoinmentStatus})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg shadow-inner",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:"Consultation Status :"}),s&&s.appoinmentStatus==="Booked"&&e.jsxs("div",{className:"mt-6 flex justify-center space-x-4",children:[e.jsx("button",{className:"bg-green-500 text-white py-2 px-6 rounded-md shadow hover:bg-green-700",onClick:()=>S("Consulted"),children:"Success"}),e.jsx("button",{className:"bg-red-500 text-white py-2 px-6 rounded-md shadow hover:bg-red-700",onClick:()=>S("unConsulted"),children:"Failure"})]})]})}),e.jsx("div",{className:"flex justify-center items-center mt-4 md:col-span-2",children:c?e.jsxs("button",{className:"bg-blue-900 text-white py-2 px-4 rounded-md shadow hover:bg-blue-800 flex items-center",onClick:U,children:[e.jsx(ne,{className:"mr-2"})," View Prescription"]}):e.jsxs("button",{className:"bg-blue-900 text-white py-2 px-4 rounded-md shadow hover:bg-blue-800 flex items-center",onClick:Z,children:[e.jsx(ae,{className:"mr-2"})," Add Prescription"]})})]}):e.jsx(e.Fragment,{children:e.jsxs("p",{className:"text-red-500 text-md font-bold ",children:["Appointment cancelled",e.jsx("br",{}),"Reason: ",s.appoinmentCancelReason]})})]}):e.jsx("p",{className:"text-center text-gray-700 ",children:"No patient details available."})]}),I&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Add Prescription"}),e.jsxs("div",{className:"mt-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Prescription Date"}),e.jsx("input",{type:"date",className:"border rounded-lg px-3 py-2 w-full focus:outline-none focus:border-blue-800",value:y,onChange:t=>k(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Doctor's Name"}),e.jsx("input",{type:"text",className:"border rounded-lg px-3 py-2 w-full focus:outline-none focus:border-blue-800",value:H,onChange:t=>z(t.target.value)})]}),i.map((t,a)=>e.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4",children:[e.jsx("input",{type:"text",className:"border rounded-lg px-3 py-2 w-full",placeholder:"Medicine Name",value:t.name,onChange:n=>{const r=[...i];r[a].name=n.target.value,u(r)}}),e.jsx("input",{type:"text",className:"border rounded-lg px-3 py-2 w-full",placeholder:"Dosage",value:t.dosage,onChange:n=>{const r=[...i];r[a].dosage=n.target.value,u(r)}}),e.jsx("input",{type:"text",className:"border rounded-lg px-3 py-2 w-full",placeholder:"Instructions",value:t.instructions,onChange:n=>{const r=[...i];r[a].instructions=n.target.value,u(r)}}),a>0&&e.jsx("button",{className:"text-red-600 hover:text-red-800",onClick:()=>{const n=i.filter((r,J)=>J!==a);u(n)},children:"Remove"})]},a)),e.jsx("button",{className:"text-blue-800 hover:text-blue-600 font-semibold",onClick:()=>u([...i,{name:"",dosage:"",instructions:""}]),children:"Add More Medicines"})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx("button",{onClick:R,className:"bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600",children:"Cancel"}),e.jsx("button",{onClick:K,className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600",children:"Save"})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Prescription Details"}),c?e.jsxs("div",{children:[e.jsxs("div",{className:"mt-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Prescription Date"}),e.jsx("p",{className:"text-gray-900",children:new Date(c.prescriptionDate).toLocaleDateString()})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Medicines"}),e.jsx("ul",{className:"list-disc list-inside",children:(P=c==null?void 0:c.medicines)==null?void 0:P.map((t,a)=>e.jsxs("li",{className:"text-gray-900",children:[t.name," - ",t.dosage," -"," ",t.instructions]},a))})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>g(!1),className:"bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600",children:"Close"}),e.jsx("button",{onClick:async()=>{try{await x.delete(`${m}/prescription/${c._id}`),d("Prescription deleted successfully","success"),v(null),g(!1)}catch(t){console.error("Error deleting prescription:",t),d("Error deleting prescription","error")}},className:"bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600",children:"Delete Prescription"})]})]}):e.jsx("p",{className:"text-center text-gray-700",children:"No prescription details available."})]})})]})},ve=()=>e.jsxs(e.Fragment,{children:[e.jsx(Y,{}),e.jsx(le,{}),e.jsx(ee,{})]});export{ve as default};
