import{a as n}from"./axios-B6xwUs71.js";import{j as c}from"./index-VWaDGczM.js";import{F as l,t as f,H as h,T as d}from"./index-BZQwGW2S.js";import{s as k}from"./toaster-DBZDDvmy.js";import{g}from"./setnget-jfIHgayU.js";const u=(o,e="success")=>{l.dispatch(f()),k(o,e)},p=(o,e="success")=>{l.dispatch(h()),k(o,e)},T=n.create(),w=async()=>{try{let o=g("refresh_token");const{data:e}=await n.post(d+"/refresh_token",{refresh_token:o});return e==null?void 0:e.access_token}catch{u("Session expired ,please Login")}},y=async()=>{var o;try{let e=g("access_token");if(!e){console.warn("Access token is missing, requesting new access token");const i=await w();if(!i)throw new Error("Failed to obtain new access token");e=i}const{data:t}=await n.get(d+`/accessToken?access_token=${e}`);let r=e,s=(t==null?void 0:t.user)||(t==null?void 0:t.doctor);const m=await c(r),{role:a}=m;return(a==="doctor"||a==="user")&&(s.isBlocked?u("Your account has been blocked by administrator","error"):(o=s==null?void 0:s.doctor)!=null&&o.isBlocked&&p("Your account has been blocked by administrator","error")),r}catch(e){console.log(e,"Error in getting token")}};T.interceptors.request.use(async o=>{let e=new Date,t,r;try{r=await y(),t=await c(r),console.log(t,"decodedToken")}catch(s){console.log("error in decodeToken"+s)}if(t.exp*1e3<e.getTime()){for(let s=0;s<100;s++)console.log(t.exp+"  : decoaded token ");r=await w(),t=c(r)}return o.headers.Authorization="Bearer "+r,o});export{T as a,u as l};
