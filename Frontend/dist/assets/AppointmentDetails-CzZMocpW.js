import{m as X,b as Y,u as ee,r as o,z as T,o as te,j as e,U as d,C as se}from"./index-FtoaIzxn.js";import{N as ne}from"./navbar--kMTgj1R.js";import{a as m}from"./axiosService-Bk3JA0V8.js";import{s as p}from"./toaster-DOicKWBQ.js";import{c as oe,d as ae}from"./index-Bp2lwcmh.js";import{F as re}from"./index-Bvt82b2g.js";import{a as ie}from"./axios-B6xwUs71.js";import"./logo-NL4NpGi6.js";import"./setnget-jfIHgayU.js";import"./index-VWaDGczM.js";import"./iconBase-CbxJS-00.js";const ve=()=>{var A,E;const u=X(t=>t.UserSlice),{id:c}=Y(),j=ee(),[s,N]=o.useState(null),[r,M]=o.useState(null),[$,h]=o.useState(!1),[F,v]=o.useState(!1),[z,b]=o.useState(!1),[g,y]=o.useState(null),[C,H]=o.useState(""),[S,D]=o.useState(""),[k,P]=o.useState(1),[x,R]=o.useState(!1),f=u.id,U=u.name,B=T.ZegoUIKitPrebuilt.generateKitTokenForTest(1874253558,"b20915d03efd29962f6e3dc9c4e02ac0",null,f,U);T.ZegoUIKitPrebuilt.create(B).addPlugins({ZIM:te.ZIM}),o.useEffect(()=>{const t=async()=>{try{const l=(await m.get(`${d}/bookingdetails/${c}`)).data.data.bookingDetails;N(l);const i=await m.get(`${d}/doctor/${l.doctorId}`);M(i.data.doctor),await a()}catch(n){console.error("Error fetching booking details:",n)}},a=async()=>{try{const n=await m.get(`${d}/reviewexists`,{params:{appointment:c}});R(n.data.reviewExists)}catch(n){console.error("Error checking review existence:",n)}};t()},[c,f]);const Z=async()=>{try{const t=new Date(s.date),a=new Date,n=(t.getTime()-a.getTime())/(1e3*60*60);let l=s.fee;n<6&&(l=s.fee*.8),await m.put(`${d}/bookingdetails/${c}`,{appoinmentStatus:"Cancelled",cancelReason:C,refundAmount:l}),N(i=>({...i,appoinmentStatus:"Cancelled"})),p("Appointment Cancelled","success"),h(!1)}catch(t){console.error("Error cancelling appointment:",t)}},K=(t,a)=>{let[n,l]=a.split(" "),[i,L]=n.split(":").map(Number);l==="PM"&&i<12&&(i+=12),l==="AM"&&i===12&&(i=0);const w=new Date(t);w.setHours(i,L,0,0);const Q=new Date(w.getTime()-60*60*1e3),I=new Date;return I>=Q&&I<=w},O=()=>{j(`/user/appoinment/${s.doctorId}`)},W=()=>{const t=new Date(s.date);if(K(t,s.timeSlot))return e.jsx("p",{className:"text-green-700 text-xl font-bold",children:"Please stay on this site. The doctor will connect with you on time."});if(s.appoinmentStatus==="Booked")return e.jsx("button",{onClick:()=>h(!0),className:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded mt-5",children:"Cancel Appointment"});if(s.appoinmentStatus==="Cancelled")return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-red-700 text-xl text-bold",children:"Appointment Cancelled"}),e.jsx("button",{onClick:O,className:"bg-green-800 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:"Reschedule Appointment"})]});if(s.appoinmentStatus==="Consulted"||s.appoinmentStatus==="unConsulted")return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-green-700 text-xl text-bold",children:"Consultation Completed"}),e.jsx("button",{onClick:()=>b(!0),className:`bg-green-700 hover:bg-green-600 text-white font-bold py-2 px-4 rounded mt-5 ${x?"opacity-50 cursor-not-allowed":""}`,disabled:x,children:x?"Review Added":"Add Review"})]})},_=async t=>{const a={appoinmentId:t},n=await m.post(`${d}/fetchPrescription`,a);n.data&&n.data.response?(y(n.data.response),v(!0)):p("No prescription added by the doctor","error")};function V(){v(!1),y(null)}const q=()=>{b(!1)},G=()=>{ie.post(se+"/conversations",{senderId:u.id,recieverId:r._id}).then(({})=>{j("/user/chat")}).catch(()=>{console.log("error in sending chat")})},J=async()=>{try{(await m.post(`${d}/createreviews`,{review:{rating:k,reviewText:S,user:f,doctor:s.doctorId,appoinment:c}})).status===200?(p("Review submitted successfully","success"),b(!1),D(""),P(1),R(!0)):alert("Failed to submit review")}catch(t){console.error("Error submitting review:",t),p("Error submitting review","error")}};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Booking Details"}),s&&r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-green-200",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:r.profileImage,alt:r.doctorName,className:"w-40 h-40 rounded mr-4"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Dr. ",r.doctorName]}),e.jsx("p",{children:(A=r==null?void 0:r.department)==null?void 0:A.departmnetName}),e.jsx("p",{className:"text-green-600 font-semibold",children:"Verified"}),e.jsx("div",{className:"flex",children:e.jsxs("button",{onClick:()=>G(),className:"bg-blue-800 flex hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-3",children:[e.jsx(re,{className:"mr-2 mt-1"}),"Chat"]})})]})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md border ",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-1 mt-4",children:"Prescription"}),e.jsx("p",{className:"mb-3 text-blue-900",children:"Click the button to see the prescription"}),e.jsxs("button",{onClick:()=>_(c),className:"bg-green-800 flex hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:[e.jsx(oe,{className:"mr-2 mt-1"}),"Check Prescription"]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-blue-200",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:" Appointment Details "}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Date: ",new Date(s.date).toLocaleDateString()]}),e.jsxs("p",{className:"font-medium",children:["Time Slot: ",s.timeSlot]}),e.jsxs("p",{className:"font-medium",children:["Patient Name: ",s.patientName]}),e.jsxs("p",{className:"font-medium",children:["Patient Problem: ",s.patientProblem]}),W()]})]})]}),$&&e.jsx("div",{className:"fixed top-0 left-0 flex justify-center items-center w-full h-full bg-gray-900 bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-xl transform transition-all max-w-lg w-full",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Reason for Cancellation"}),e.jsx("div",{className:"mt-2",children:e.jsx("textarea",{value:C,onChange:t=>H(t.target.value),className:"block w-full p-2 sm:text-sm border-gray-300 rounded-md",rows:4,placeholder:"Enter reason for cancellation"})})]}),e.jsxs("div",{className:"bg-gray-100 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{onClick:Z,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-500 text-base font-medium text-white hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm",children:"Confirm"}),e.jsx("button",{onClick:()=>h(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancel"})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-lg w-full",children:g?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 border-b pb-2",children:"Prescription Details"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-bold",children:"Doctor:"})," ",r.doctorName]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-bold",children:"Prescription Date:"})," ",new Date(g.prescriptionDate).toDateString()]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Medicines:"}),e.jsx("ul",{className:"list-disc list-inside pl-4 space-y-2",children:(E=g.medicines)==null?void 0:E.map((t,a)=>e.jsxs("li",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",e.jsx("span",{className:"text-red-700",children:t.name})," -",e.jsx("span",{className:"font-semibold",children:" Dosage:"})," ",e.jsx("span",{className:"text-red-700",children:t.dosage})," -",e.jsx("span",{className:"font-semibold",children:" Instructions:"})," ",e.jsx("span",{className:"text-red-700",children:t.instructions})]},a))})]}),e.jsx("div",{className:"flex justify-end space-x-4",children:e.jsx("button",{onClick:V,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition ease-in-out duration-300",children:"Close"})})]}):e.jsx("p",{className:"text-gray-700",children:"No Prescription added ..."})})}),z&&e.jsx("div",{className:"fixed top-0 left-0 flex justify-center items-center w-full h-full bg-gray-900 bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Review Appointment"}),e.jsx("button",{onClick:q,className:"text-gray-500 hover:text-gray-600",children:e.jsx(ae,{})})]}),e.jsx("textarea",{className:"w-full h-32 p-2 border border-gray-300 rounded mb-4",placeholder:"Write your review",value:S,onChange:t=>D(t.target.value)}),e.jsx("label",{className:"block mb-2 font-bold",children:"Rating:"}),e.jsxs("select",{value:k,onChange:t=>P(parseInt(t.target.value)),className:"w-full p-2 border border-gray-300 rounded mb-4",children:[e.jsx("option",{value:1,children:"1 - Very Poor"}),e.jsx("option",{value:2,children:"2 - Poor"}),e.jsx("option",{value:3,children:"3 - Average"}),e.jsx("option",{value:4,children:"4 - Good"}),e.jsx("option",{value:5,children:"5 - Excellent"})]}),e.jsx("button",{onClick:J,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:x?"Review Added":"Submit Review"})]})})]})]})};export{ve as default};
